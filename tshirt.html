<!DOCTYPE html>
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <title></title>
  
  <meta name="viewport" content="width=device-width,user-scalable=no"/>
  
 
  <!-- <link rel="icon" href="favicon.ico" type="image/ico"> -->

  <link id="main_styles" rel="stylesheet" href="css/main.css" type="text/css">

  <script type="text/javascript">
    var CONFIG = {
      devMode: (window.location.hostname.substr(0,3) == '192' || 
                window.location.hostname == 'localhost' || window.location.origin == "file://")
    };
    
    if (CONFIG.devMode) { // switch in .less for dev
      var l = document.getElementById('main_styles');
      l.rel = 'stylesheet/less';
      l.href = 'less/main.less';
    }

    function js (file) {
      document.write( unescape("%3Cscript src='js/" + file + "' type='text/javascript'%3E%3C/script%3E") );
    }

    if (CONFIG.devMode) {
      js( 'lib/less.js' );
      js( 'dev.js' );
    }
        
    js( 'lib/jquery-1.7.min.js' );
    js( 'lib/underscore.js' );
    js( 'lib/custom/dat.gui.js' );
    js( '/lib/canvas/paper.js' );
    js( 'utils.js' );
    js( 'main.js');
  </script>

  <script type="text/javascript">
  
    var current = {
      vert:   5,
      wiggle: 0,
      thick:  2
    };
    
    var previous = {
      vert:   0,
      wiggle: 0,
      thick:  0
    }
    
    var steps = {
      vert:   0.01,
      wiggle: 0.25,
      thick:  0.05
    };
    
    var last_pos = {
      vert:   0,
      wiggle: 0,
      thick:  0
    };
    
    var p = {
      pause: false,
      inputs: current
    };
    
    var J = { // mocked snorkle.js so we don't have to change code from prototyping in snorkle to here
      updateReals: function() {
      },
      recalculate: function() {},
      reals: current
    };
    
    var mine = function(ev, n) {
      var i = ev.count;
      var b = n % 2,
          c = Math.floor(n / 2) * p.inputs.vert,
          d = Math.sin(n * 10000) * p.inputs.wiggle,
          e = 2; // Math.sin(i / 50);

      p.path.strokeWidth = p.inputs.thick;
      p.path.strokeColor = '#ff0';

      return {   x: 0 + b * p.width,
                 y: 3 + d + c
      };
    }
    
    
    
    $(function() {
      var gui = new dat.GUI({  });
      gui.add(current, 'vert',     0, 10).step(0.01).listen();
      gui.add(current, 'wiggle', -10, 10).step(0.25).listen();
      gui.add(current, 'thick',    0,  5).step(0.05).listen();
      
      $('.slider').bind('touchend', function(e) {
        var v = $(this).parents( 'li.cr' ).find( '.property-name' ).text();        
        var x = e.originalEvent.changedTouches[0].clientX;
        
        if (x < 40) {
          current[v] -= steps[v];
        } else if (x > 280) {
          current[v] += steps[v];
        }
      })
      
      $('.slider').bind('touchmove', function(e) {
        var v = $(this).parents( 'li.cr' ).find( '.property-name' ).text(),
            pos = e.originalEvent.pageX,
            movement = Math.abs(last_pos[v] - pos);
        
        if (movement > 1) {
          if (last_pos[v] < pos) {
            current[v] += steps[v];
          } else {
            current[v] -= steps[v];          
          }
        }
        
        last_pos[v] = pos;
      });
      
      _.delay(function() {
        $('div.dg.main.a').css({ width: "100%" });
        // less.watchMode = true;
      }, 100);
    })
  </script>
</head>

<body>
  
  
  <canvas id="canvas" keepalive="true" width='640' height='960'></canvas>
  
  <!-- <a href="paper.html">yeah</a> -->
</body>

<script type="text/paperscript" canvas="canvas">
  p.points = 399;
  p.smooth = false;
  p.mousePos = view.center / 2;
  p.pathHeight = p.mousePos.y;
  p.project = project;
  
  p.path = new Path();
  p.path.strokeColor = 'red';
  // p.path.fillColor = 'white';
  p.path.closed = false;    

  p.initializePath = function (points) {
    p.points = points || p.points;
    
    p.center = view.center;
    p.width  = view.size.width;
    p.height = view.size.height / 2;
    p.path.segments = [];
    for (var i = 0; i < p.points; i++) {
      var point = new Point(p.width / p.points * i, p.center.y);
      p.path.add(point);
    }
    p.path.fullySelected = false;
  }

  p.initializePath();


  function onFrame(event) {
    if (p.pause) return;
    // $fps.text(1/ event.delta);      
    
    var no_op = _.isEqual( previous, current );
    
    previous = _.clone( current );
    
    if (no_op) return;
    
    p.pathHeight += (p.center.y - p.mousePos.y - p.pathHeight) / 10;
    
    J.updateReals();
    J.recalculate();
    
    // p.inputs = J.reals;
    
    for (var i = 0; i < p.points; i++) {
      var pos = mine.call(p, event, i); // call with this set to p
      p.path.segments[i].point.y = pos.y;
      p.path.segments[i].point.x = pos.x;
    }
  
    if (p.smooth) { p.path.smooth(); }
  }
  
</script>

</html>

<!-- <script type="text/javascript" src="http://use.typekit.com/hlx2kdo.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script> -->

<!-- <script src="http://www.google-analytics.com/urchin.js" type="text/javascript"> </script> 
<script type="text/javascript"> 
  _uacct = "UA-1333551-1";
  if (! DEV) urchinTracker();
</script> -->

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <title></title>
  
  <meta name="viewport" content="width=device-width,user-scalable=no"/>
  
  <!-- <link rel="icon" href="favicon.ico" type="image/ico"> -->

  <link id="main_styles" rel="stylesheet" href="css/main.css" type="text/css">

  <!-- before jquery - needed to write to SVG -->
  <script type="text/javascript" src="js/lib/meh/MochiKit/MochiKit.js"></script> 

  <script type="text/javascript">
    var CONFIG = {
      devMode: (window.location.hostname.substr(0, 3) == '192' || 
                window.location.hostname == 'localhost' || window.location.origin == "file://")
    };
    
    if (CONFIG.devMode) { // switch in .less for dev
      var l = document.getElementById('main_styles');
      l.rel = 'stylesheet/less';
      l.href = 'less/main.less';
    }

    function js (file) {
      document.write( unescape("%3Cscript src='js/" + file + "' type='text/javascript'%3E%3C/script%3E") );
    }

    if (CONFIG.devMode) {
      js( 'lib/less.js' );
      js( 'dev.js' );
    }
        
    js( 'lib/jquery-1.7.min.js' );
    js( 'lib/underscore.js' );
    js( 'lib/custom/dat.gui.js' );
    js( '/lib/canvas/paper.js' );
    js( 'utils.js' );
    js( 'main.js');
  </script>
  
  <script type="text/javascript" src="js/lib/canvas/SVGKit.js"></script> 
  <script type="text/javascript" src="js/lib/canvas/SVGCanvas.js"></script>
  
  <script type="text/javascript">
    paper.install(window);

    var current = {
      vert:   20,
      wiggle: 0,
      thick:  2
    };
    
    var previous = {
      vert:   0,
      wiggle: 0,
      thick:  0
    }
    
    var steps = {
      vert:   1,
      wiggle: 0.25,
      thick:  0.05
    };
    
    var last_pos = {
      vert:   0,
      wiggle: 0,
      thick:  0
    };
    
    var last_zoom = 1;
    var pause = false;
    
    var v = {
      inputs: current
    };
    
    var J = { // mocked snorkle.js so we don't have to change code from prototyping in snorkle to here
      updateReals: function() {
      },
      recalculate: function() {},
      reals: current
    };
    
    var mine = function(ev, n) {
      var i = ev.count;
      var b = n % 2,
          c = Math.floor(n / 2) * v.inputs.vert,
          d = Math.sin(n * 10000) * v.inputs.wiggle,
          e = 2; // Math.sin(i / 50);

      v.path.strokeWidth = v.inputs.thick;
      v.path.strokeColor = '#ff0';

      return {   x: 0 + b * v.width,
                 y: 3 + d + c
      };
    }
    
    $(function() {
      var gui = new dat.GUI({  });
      gui.add(current, 'vert',     0, 40).step(.5).listen();
      gui.add(current, 'wiggle', -10, 10).step(0.25).listen();
      gui.add(current, 'thick',    0,  5).step(0.05).listen();
      
      $('.slider').bind('touchend', function(e) {
        var v = $(this).parents( 'li.cr' ).find( '.property-name' ).text();        
        var x = e.originalEvent.changedTouches[0].clientX;
        
        if (x < 40) {
          current[v] -= steps[v];
        } else if (x > 600) {
          current[v] += steps[v];
        }
      });

      $('.slider').bind('touchend', function(e) {
        return false;
      });

      $('.slider').bind('touchstart', function(e) {
        var v = $(this).parents( 'li.cr' ).find( '.property-name' ).text();
        
        last_pos[v] = e.originalEvent.pageX;
        return false;
      });

      $('.slider').bind('touchmove', function(e) {
        var v = $(this).parents( 'li.cr' ).find( '.property-name' ).text(),
            pos = e.originalEvent.pageX,
            movement = Math.abs(last_pos[v] - pos);

        if (movement > 1) {
          if (last_pos[v] < pos) {
            current[v] += steps[v] * movement / 10;
          } else {
            current[v] -= steps[v] * movement / 10;
          }
        }
        
        last_pos[v] = pos;
        return false;
      });
      
      // view.scrollBy( point )
      
      $('button.zoom').click(function() {
        if (view.zoom == 1 && this.id == 'out') {
          $('body').addClass('tshirt_view');
          return;
        }
        
        if ($('body').is('.tshirt_view') && this.id == 'in') {
          $('body').removeClass('tshirt_view');
          return;
        }
      
        view.zoom = view.zoom * (this.id == 'in' ? 2 : 0.5);
      });
      
      $('button.tweak').click(function() {
        $('body').toggleClass('tweak');
      });
      
      _.delay(function() {
        $('div.dg.main.a').css({ width: "100%" });
        // less.watchMode = true;
        window.scrollTo(0, 1);
        
      }, 100);
    });
    
    
    // refactor this to a separate file

    var breton_and_on = function() {
      var canvas = document.getElementById('canvas');
      paper.setup(canvas);// Create an empty project and a view for the canvas:
      
      v = {
        inputs: current,
        points: 399,
        smooth: false,
        mousePos: view.center / 2
      };

      v.pathHeight = v.mousePos.y;      
      v.path = new Path();
      v.path.strokeColor = 'red';
      // path.fillColor = 'white';
      v.path.closed = false;    

      v.text = new PointText(new Point(150, 420));
      v.text.content = 'Hello world.';
      v.text.characterStyle = { fontSize: 50, fillColor: 'white', font: 'Helvetica' };

      v.text2 = new PointText(new Point(50, 350));
      v.text2.content = 'Hello world.';
      v.text2.characterStyle = { fontSize: 50, fillColor: 'white', font: 'Minion Pro' };

      v.initializePath = function (points) {
        v.points = points || v.points;

        // v.center = view.center;
        v.width  = view.size.width;
        v.height = view.size.height / 2;

        v.path.segments = [];
        for (var i = 0; i < v.points; i++) {
          var point = new Point(v.width / v.points * i, view.center.y);
          v.path.add(point);
        }
        v.path.fullySelected = false;
      }

      v.initializePath();

      view.onFrame = function (event) {     
        if (pause) return;
        // $fps.text(1/ event.delta);      

        var no_op = _.isEqual( previous, current );

        previous = _.clone( current );

        if (no_op && last_zoom == view.zoom) return;
        last_zoom = view.zoom;

        v.pathHeight += (view.center.y - v.mousePos.y - v.pathHeight) / 10;

        J.updateReals();
        J.recalculate();

        // inputs = J.reals;

        for (var i = 0; i < v.points; i++) {
          var pos = mine.call(v, event, i); // call with this set to p
          v.path.segments[i].point.y = pos.y;
          v.path.segments[i].point.x = pos.x;
        }

        if (v.smooth) { v.path.smooth(); }
      }
    };
    
    $(breton_and_on);
    
    
  </script>
</head>

<body class="tweak">
  <div id="main">
    <canvas id="canvas" keepalive="true" width='610' height='860'></canvas>
    <img src="images/t-black.jpg" id="t">
  </div>
  
  <div id="bar">
    <button class="zoom" id="out">-</button>
    <button class="zoom" id="in">+</button>
  
    <button class="tweak">%</button>
  </div>
  
  <!-- <a href="paper.html">yeah</a> -->
</body>

<script type="text/javascript">




</script>



</html>

<!-- <script type="text/javascript" src="http://use.typekit.com/hlx2kdo.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script> -->

<!-- <script src="http://www.google-analytics.com/urchin.js" type="text/javascript"> </script> 
<script type="text/javascript"> 
  _uacct = "UA-1333551-1";
  if (! DEV) urchinTracker();
</script> -->
